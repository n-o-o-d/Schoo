import tkinter as tk
from tkinter import messagebox, filedialog
import qrcode
import webbrowser
import os

class QRApp:
    def __init__(self, root):
        self.root = root
        self.root.title("QR Code Generator")
        self.root.geometry("500x550")
        self.root.minsize(480, 500)
        self.root.iconbitmap("qr.ico")

        tk.Label(root, text="Enter Child Details", font=("Arial", 16)).pack(pady=10)

        self.name = tk.Entry(root, width=40)
        tk.Label(root, text="Name:").pack()
        self.name.pack(pady=5)

        self.school = tk.Entry(root, width=40)
        tk.Label(root, text="School:").pack()
        self.school.pack(pady=5)

        self.grade = tk.Entry(root, width=40)
        tk.Label(root, text="Class / Grade:").pack()
        self.grade.pack(pady=5)

        self.roll = tk.Entry(root, width=40)
        tk.Label(root, text="Roll No.:").pack()
        self.roll.pack(pady=5)

        self.contact = tk.Entry(root, width=40)
        tk.Label(root, text="Parent Contact:").pack()
        self.contact.pack(pady=5)

        self.address = tk.Entry(root, width=40)
        tk.Label(root, text="Address:").pack()
        self.address.pack(pady=5)

        tk.Button(root, text="Generate QR", command=self.generate_qr, bg="green", fg="white").pack(pady=5)
        tk.Button(root, text="Download QR", command=self.download_qr, bg="blue", fg="white").pack(pady=5)
        tk.Button(root, text="Email (Gmail)", command=self.email_qr, bg="orange", fg="white").pack(pady=5)

        self.qr_image = None
        self.last_saved_path = None

    def generate_qr(self):
        data = "Name: " + self.name.get() + "\nSchool: " + self.school.get() + "\nClass: " + self.grade.get()
        data += "\nRoll No.: " + self.roll.get() + "\nParent Contact: " + self.contact.get() + "\nAddress: " + self.address.get()

        if self.name.get() == "":
            messagebox.showerror("Error", "Please enter at least the name.")
            return

        self.qr_image = qrcode.make(data)
        messagebox.showinfo("Success", "QR Code Generated!")

    def download_qr(self):
        if self.qr_image is None:
            messagebox.showerror("Error", "Generate QR first.")
            return

        path = filedialog.asksaveasfilename(defaultextension=".png", filetypes=[("PNG files", "*.png")])
        if path:
            self.qr_image.save(path)
            self.last_saved_path = path
            messagebox.showinfo("Saved", "QR Code saved!")

    def email_qr(self):
        if self.qr_image is None:
            messagebox.showerror("Error", "Generate QR first.")
            return

        if not self.last_saved_path:
            temp_path = os.path.join(os.getcwd(), "temp_qr.png")
            self.qr_image.save(temp_path)
            self.last_saved_path = temp_path

        recipient = self.contact.get()
        subject = "Child QR Code"
        body = "QR saved at:\n" + self.last_saved_path + "\nAttach it before sending."
        gmail_url = "https://mail.google.com/mail/?view=cm&fs=1&to=" + recipient + "&su=" + subject + "&body=" + body
        webbrowser.open(gmail_url)

root = tk.Tk()
app = QRApp(root)
root.mainloop()
